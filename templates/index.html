<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò —Ç—Ä–µ–Ω–∞–∂–µ—Ä —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üá∑üá∫ –ò–ò —Ç—Ä–µ–Ω–∞–∂–µ—Ä —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ üéØ</h1>
            <p>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –Ω–∞—á–∏–Ω–∞–π —É—á–∏—Ç—å—Å—è!</p>
        </header>

        <main>
            {% if not show_lessons and not show_lesson %}
            <div class="levels">
                <h2>–£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ üìä</h2>
                {% for level in levels %}
                <a href="/level/{{ level.id }}" class="btn level-btn">
                    <span class="emoji">{{ level.emoji }}</span>
                    {{ level.name }}
                </a>
                {% endfor %}
            </div>

            {% elif show_lessons and not show_lesson %}
            <div class="lessons">
                <h2>–£—Ä–æ–∫–∏ —É—Ä–æ–≤–Ω—è üìö</h2>
                {% for lesson in lessons %}
                <a href="/level/{{ current_level }}/lesson/{{ lesson.id }}" class="btn lesson-btn">
                    <span class="emoji">{{ lesson.emoji }}</span>
                    {{ lesson.name }}
                </a>
                {% endfor %}

                <a href="/" class="btn back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ —É—Ä–æ–≤–Ω—è–º</a>
            </div>

            {% elif show_lesson %}
            <div class="lesson-content">
                <h2>{{ current_lesson.emoji }} {{ current_lesson.name }}</h2>
                <div class="content">
                    {{ current_lesson.content|safe }}
                </div>

                <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ -->
                <div class="audio-upload">
                    <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è üé§</h3>
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å –≤–∞—à–∏–º –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º —Ñ—Ä–∞–∑—ã:</p>
                    <p class="phrase-to-pronounce">"–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"</p>

                    <div class="upload-container">
                        <input type="file" id="audioFile" accept="audio/*" class="file-input">
                        <label for="audioFile" class="file-label">
                            <span class="file-emoji">üìÅ</span> –í—ã–±—Ä–∞—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
                        </label>
                        <button id="uploadBtn" class="upload-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>

                    <!-- –¢–ï–õ–ï–ì–†–ê–ú –†–ï–ö–û–†–î–ï–† -->
                    <div class="telegram-recorder">
                        <p>–ò–ª–∏ –∑–∞–ø–∏—à–∏ –≥–æ–ª–æ—Å –ø—Ä—è–º–æ –∑–¥–µ—Å—å:</p>
                        <button onclick="recordVoice()" class="record-btn">üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å</button>
                    </div>

                    <div id="loading" class="loading" style="display: none;">
                        <p>‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ...</p>
                    </div>

                    <div id="result" class="result-container" style="display: none;">
                        <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</h4>
                        <div class="score">
                            –û—Ü–µ–Ω–∫–∞: <span id="scoreValue">0</span>/100
                        </div>
                        <div class="feedback">
                            <p>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:</p>
                            <p id="feedbackText"></p>
                        </div>
                    </div>

                    <div id="error" class="error-container" style="display: none;">
                        <p class="error-text"></p>
                    </div>
                </div>

                <a href="/level/{{ current_level }}" class="btn back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ —É—Ä–æ–∫–∞–º</a>
            </div>
            {% endif %}
        </main>

        <footer>
            <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <script>
    function recordVoice() {
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.recordAudio();
        } else {
            alert("–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Telegram");
        }
    }

    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.onEvent('recordAudioReceived', (data) => {
            console.log("–ê—É–¥–∏–æ –∑–∞–ø–∏—Å–∞–Ω–æ!", data);
            // –ó–¥–µ—Å—å –æ—Ç–ø—Ä–∞–≤–∫–∞ data.blob –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        });
    }
    </script>
</body>
</html>